(function(f,a,d){f[a]={};var c=function(j,h){for(var k in h){j[k]=h[k]}return j};var b=function(i,h){window.console&&window.console[h||"log"](i)};var g={isIE:false,isIE6:false};var e=function(j,k,l){var i=k-String(j).length;if(i<0){return j}var h=new Array(k-String(j).length||0);h.push(j);return h.join(l||"0")};c(f[a],{"mix":c,"log":b,"B":g,"pad":e})})(window,"Jun",undefined);(function(){Jun.dom={get:function(b){return document.getElementById(b)},$:function(b){return document.getElementById(b)},getTG:function(c,b){return c.getElementsByTagName(b)},query:function(b){return document.querySelector(b)},create:function(b){return document.createElement(b)},first:function(b){var c=b.firstElementChild;if(c||c===null){return c}b=b.firstChild;while(b!=null&&!this.isElement(b)){b=b.nextSibling}return b},last:function(c){var b=c.lastElementChild;if(b||b===null){return b}b=c.lastChild;if(b===null||this.isElement(b)){return b}return this.prev(b)},hasChilds:function(b){return b.hasChildNodes()},parent:function(b){return b.parentNode},next:function(c){var b=c.nextElementSibling;if(b||b===null){return b}b=c.nextSibling;if(b===null||this.isElement(b)){return b}return this.next(b)},prev:function(c){var b=c.previousElementSibling;if(b||b===null){return b}b=c.previousSibling;if(b===null||this.isElement(b)){return b}return this.prev(b)},find:function(c,b){throw"Jun.dom.find Error"},attr:function(c,b,d){if(d){c.setAttribute(b,d);return c}else{c.getAttribute(b)}},removeAttr:function(c,b){c.removeAttribute(b);return c},css:function(c,b,d){if(d===undefined){b=b.replace(/([A-Z])/g,"-$1");b=b.toLowerCase();return parseFloat(window.getComputedStyle(c,null).getPropertyValue(b))}else{c.style[b]=d;return c}},isElement:function(b){return b.nodeType==1},isText:function(b){return b.nodeType==3},isString:function(b){return typeof b==="string"},html:function(c,b){if(b){c.innerHTML=b;return c}else{return c.innerHTML}},htmlForElem:function(c){var d=this.create("DIV");var b=document.createDocumentFragment("DIV");d.innerHTML=c;while(d.firstChild){b.appendChild(d.firstChild)}return b},remove:function(c){var b=this.parent(c);return b&&b.removeChild(c)},before:function(c,b){if(this.isString(b)){b=this.htmlForElem(b)}return c.parentNode.insertBefore(b,c)},after:function(d,c){if(this.isString(c)){c=this.htmlForElem(c)}var b=this.parent(d);return b.lastChild==d?b.appendChild(c):b.insertBefore(c,d.nextSibling)},append:function(c,b){if(this.isString(b)){b=this.htmlForElem(b)}return c.appendChild(b)},animate:function(g,c,d,f,e,j){j=j||"px";e=e||300;var h=parseFloat(Jun.dom.css(g,c));d=d-h;var k=new Date().getTime();var i=setInterval(function(){var b=new Date().getTime()-k;if(b>e){b=e;clearInterval(i);callback&&callback()}g.style[c]=parseFloat(a.eain(b,h,d,e))},10);return i},on:function(b,d,c){if(b.addEventListener){b.addEventListener(d,c,false)}else{if(b.attachEvent){b.attachEvent("on"+d,c)}else{b["on"+d]=c}}return b},off:function(b,d,c){if(b.removeEventListener){b.removeEventListener(d,c,false)}else{if(b.detachEvent){b.detachEvent("on"+d,c)}else{b["on"+d]=null}}return b}};var a={eain:function(f,e,h,g){return -h*(f/=g)*(f-2)+e}}})();var Puzz=function(d,g,a,e,f,c,b,h){this.ele=null;this.left=0;this.top=0;this.defaultBackground="#fff";this.width=g;this.height=a;this.size=e;this.wrap=f;this.url=c;this.end=b;this.index=d+1;this.x=0;this.y=0;this.puzzle=h};Jun.mix(Puzz.prototype,{init:function(){this.create()},setLeft:function(a){this.left=a+"px"},setTop:function(a){this.top=a+"px"},setDefaultBackground:function(a){this.defaultBackground=a},getProperty:function(a){return this[a]},move:function(a,b){this.setLeft(a*this.width);this.setTop(b*this.height);this.update();this.x=a;this.y=b},create:function(){var c=Jun.dom.create("div");c.className="puzz-item";c.style.width=this.width+"px";c.style.height=this.height+"px";this.ele=c;var a=parseInt((this.index-1)/this.size);var b=parseInt((this.index-1)%this.size);if(this.url&&this.end==false){this.setShowBackground("url("+this.url+") no-repeat -"+(b*this.width)+"px -"+(a*this.height)+"px")}else{this.setShowBackground(this.defaultBackground)}this.move(b,a)},setShowInt:function(){var a=Jun.dom.create("p");a.innerText=this.index;Jun.dom.append(this.ele,a)},setShowBackground:function(a){this.ele.style.background=a},update:function(){this.ele.style.left=this.left;this.ele.style.top=this.top},isOkay:function(){return parseInt((this.index-1)/this.size)==this.y&&parseInt((this.index-1)%this.size)==this.x},drawing:function(a,c){Jun.dom.append(this.wrap,this.ele);var b=this;this.ele.onclick=function(){b.puzzle.regEvent(b.y,b.x,b.index)}},hide:function(){this.ele.className="puzz-item hide"},show:function(){this.ele.className="puzz-item"}});var Puzzle=function(g,e,b,c,d,a){var f=Jun.dom;this.id=g;this.ele=f.$(g);this.url=c;this.width=e;this.height=b;this.size=d;this.order=null;this.itemList=[];this.listOrder=[];this.isNunber=a!=false?true:false;this.process=[];this.lastTime=0;this.stepCount=0;this.beginTime=0;this.timeCount=0;this.timeHTML='<div class="time"><span>0</span> <span>00:00.000</span></div>';
    this.init()};Jun.mix(Puzzle.prototype,{init:function(){this.ele.style.background="url("+this.url+")";this.itemWidth=this.width/this.size;this.itemHeight=this.height/this.size;this.process=[];this.lastTime=0;this.stepCount=0;this.beginTime=0;this.timeCount=0;if(this.itemList.length==0){this.create()}},create:function(){var g=this.itemList;var f=null;var b=false;var c="";for(var e=0,a=this.size*this.size;e<a;e++){b=(e+1==a?true:false);f=new Puzz(e,this.itemWidth,this.itemHeight,this.size,this.ele,this.url,b,this);f.init();if(this.isNunber==true&&b==false){f.setShowInt()}g.push(f)}var d=this.ele.getElementsByTagName("span");this.stepCountEle=d[0];this.timeCountEle=d[1];if(this.size==3){this.bindWindow()}},updateStepCount:function(){this.stepCountEle.innerText=this.stepCount},updateTimeCount:function(){function a(b){return Jun.pad(parseInt(b/100/60),2,"0")+":"+Jun.pad(parseInt(b/100%60),2,"0")+"."+parseInt(b%60)}this.timeCountEle.innerText=a(this.timeCount)},begin:function(){var a=this;this.beginTime=new Date().getTime();this.timeInter=setInterval(function(){a.timeCount=new Date().getTime()-a.beginTime;a.updateTimeCount()},10)},endTime:function(){clearInterval(this.timeInter)},regEvent:function(b,h,d){var e=this.size;var g=this.itemList;var a=this.listOrder;var c=null;if(this.lastTime==0){this.lastTime=new Date().getTime();this.begin()}var f={index:d,delay:new Date().getTime()-this.lastTime};this.lastTime=new Date().getTime();if(b>0&&g[a[b-1][h]].end){this.stepCount++;d!=undefined&&this.process.push(f);g[a[b][h]].move(h,b-1);g[a[b-1][h]].move(h,b);c=a[b][h];a[b][h]=a[b-1][h];a[b-1][h]=c}else{if(h<a.length-1&&g[a[b][h+1]].end){this.stepCount++;d!=undefined&&this.process.push(f);g[a[b][h]].move(h+1,b);g[a[b][h+1]].move(h,b);c=a[b][h];a[b][h]=a[b][h+1];a[b][h+1]=c}else{if(b<a.length-1&&g[a[b+1][h]].end){this.stepCount++;d!=undefined&&this.process.push(f);g[a[b][h]].move(h,b+1);g[a[b+1][h]].move(h,b);c=a[b][h];a[b][h]=a[b+1][h];a[b+1][h]=c}else{if(h>0&&g[a[b][h-1]].end){this.stepCount++;d!=undefined&&this.process.push(f);g[a[b][h]].move(h-1,b);g[a[b][h-1]].move(h,b);c=a[b][h];a[b][h]=a[b][h-1];a[b][h-1]=c}}}}this.updateStepCount();if(this.isOkay()){this.success();this.endTime()}},start:function(){var c=this.itemList;for(var b=0,a=c.length;b<a;b++){c[b].drawing()}this.shuffle()},sort:function(a){return a.sort(function(){return Math.random()-0.5})},shuffle:function(b){if(this.itemList.length==0){this.init();this.start();return}this.beginTime=0;this.stepCount=0;this.timeCount=0;this.updateStepCount();this.updateTimeCount();if(b===undefined){b=[];for(var e=0;e<this.size*this.size;e++){b.push(e)}b=this.sort(b)}while(!this.solvability(b.slice(0),this.size)){b=this.sort(b)}this.order=b;var d=this.size;var f=this.listOrder=[];var a=this.itemList;for(e=0;e<d;e++){f.push(b.slice(e*d,(e+1)*d))}for(e=0,len=f.length;e<len;e++){for(var c=0;c<f[e].length;c++){a[f[e][c]].move(c,e);a[f[e][c]].show()}}},solvability:function(c,l){var k;var g=0;var d=0;var b=0;var h=c.length;l=l||3;for(var f=0;f<h;f++){var k=c[f];if(k==8){d=parseInt(f/l);b=parseInt(f%l)}for(var e=f+1;e<h;e++){if(c[e]<k){g++}}}g+=d;g+=b;return g%2==0},isOkay:function(){var c=true;var d=this.itemList;for(var b=0,a=d.length;b<a;b++){if(!d[b].isOkay()){c=false;break}}return c},success:function(){for(var a=0;a<this.itemList.length;a++){this.itemList[a].hide()}this.stopPlay()},keyMove:function(a){var b=parseInt((a-1)/this.size);var c=parseInt((a-1)%this.size);this.regEvent(b,c)},bindWindow:function(){var b=this;var a={97:7,98:8,99:9,100:4,101:5,102:6,103:1,104:2,105:3};document.onkeyup=function(d){var f=d||window.event;var c=a[f.keyCode];if(c){b.keyMove(c)}}},stopPlay:function(){clearTimeout(this.playTimeer)},playVideo:function(){new PuzzlePlayVideo(this.id,this).play()}});function PuzzlePlayVideo(b,a){this.puzzleVoid=a;this.id=b;this.ele=dom.$(b);this.url=a.url;this.size=a.size;this.width=a.width;this.height=a.height;this.isNunber=a.isNunber;this.order=a.order;this.process=a.process.slice();this.itemList=[];this.listOrder=[];this.init()}Jun.mix(PuzzlePlayVideo.prototype,Puzzle.prototype);Jun.mix(PuzzlePlayVideo.prototype,{play:function(){var a=0;this.lastTime=0;this.stopPlay();this.shuffle(this.order);this.playStep(a)},playStep:function(c){var f=this;var b=this.order;var a=this.itemList;var d=this.process[c];var e=a[d.index-1];this.regEvent(e.y,e.x);if(c+1<this.process.length){this.playTimeer=setTimeout(function(){f.playStep(c+1)},this.process[c+1].delay)}}});